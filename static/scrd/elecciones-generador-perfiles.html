<!DOCTYPE html>
<html>
<head>
	<title>Elecciones SDACP-DRAFE 2023 - Generador de perfiles</title>
	<link href='https://fonts.googleapis.com/css?family=Source%20Sans%20Pro' rel='stylesheet'/>
	<style type="text/css">
		body {
			font-family: 'Source Sans Pro', Helvetica, Arial;
		}
		.container {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background-color: #f5f5f5;
		}
		.header-logo {
			margin: 20px 0;
			width: 600px;
		}
		.welcome {
			font-size: 18px;
			margin: 20px 0;
			text-align: center;
			width: 800px;
			border: 3px dashed #455EB5;
			padding: 20px;
			text-align: justify;
		}
		.form {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			margin-bottom: 20px;
		}
		.form input {
			margin: 10px;
			padding: 5px;
			border-radius: 5px;
			border: none;
			font-size: 16px;
		}
		.form textarea {
			margin: 10px;
			padding: 5px;
			border-radius: 5px;
			border: none;
			font-size: 16px;
			resize: none;
			height: 100px;
		}
		.btn {
			padding: 10px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 5px;
			font-size: 16px;
			cursor: pointer;
		}
		.hidden {
			display: none;
		}
		.boton {
		  background-image: linear-gradient(92.88deg, #455EB5 9.16%, #5643CC 43.89%, #673FD7 64.72%);
		  border-radius: 8px;
		  border-style: none;
		  box-sizing: border-box;
		  color: #FFFFFF;
		  cursor: pointer;
		  flex-shrink: 0;
		  font-family: 'Source Sans Pro', Helvetica, Arial;
		  font-size: 16px;
		  line-height: 4rem;
		  font-weight: 500;
		  height: 4rem;
		  padding: 0 1.6rem;
		  text-align: center;
		  text-shadow: rgba(0, 0, 0, 0.25) 0 3px 8px;
		  transition: all .5s;
		  user-select: none;
		  -webkit-user-select: none;
		  touch-action: manipulation;
		  width:100%;
		}

		.boton:hover {
		  box-shadow: rgba(80, 63, 205, 0.5) 0 1px 30px;
		  transition-duration: .1s;
		}

		@media (min-width: 768px) {
		  .boton {
			padding: 0 2.6rem;
		  }
		}
		textarea, .textarea {
		  margin-top: 10px;
		  margin-left: 50px;
		  width: 500px;
		  height: 20px;
		  -moz-border-bottom-colors: none;
		  -moz-border-left-colors: none;
		  -moz-border-right-colors: none;
		  -moz-border-top-colors: none;
		  background: none repeat scroll 0 0 rgba(0, 0, 0, 0.07);
		  border-color: -moz-use-text-color #FFFFFF #FFFFFF -moz-use-text-color;
		  border-image: none;
		  border-radius: 6px 6px 6px 6px;
		  border-style: none solid solid none;
		  border-width: medium 1px 1px medium;
		  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12) inset;
		  color: #555555;
		  font-family: 'Source Sans Pro', Helvetica, Arial;
		  font-size: 1em;
		  line-height: 1.4em;
		  padding: 5px 8px;
		  transition: background-color 0.2s ease 0s;
		}
		textarea:focus {
			background: none repeat scroll 0 0 #FFFFFF;
			outline-width: 0;
		}
		.inline {
			display: inline-block !important;
		}
	</style>
</head>
<body>
	<div class="container">
	<img class='header-logo' src='https://felipe-calvo.github.io/static/scrd/Logo%20Elecciones.png' alt='Elecciones Consejos de Cultura y Deporte 2023'/>
	<div class='welcome'>
	A través de este aplicativo las y los candidatos a los <b>Consejos de Cultura y Deporte 2023-2027</b> podrán crear un banner/flyer publicitario con el cual podrán hacer campaña. Elija una foto de perfil, ingrese su nombre, perfil, sector, tratamiento y una paleta de colores, y finalmente haga clic en el botón <b>Crear publicidad</b>.<br/>
	<br/>
	Recuerde invitar a sus familiares, amigos, compañeros, conocidos, bases culturales/deportivas y comunidades a que se <a style='color:blue' href='https://www.participacionbogota.gov.co/elecciones-consejos-de-cultura-y-deporte' target='_blank'>registren como electores en la plataforma VOTEC</a> para que puedan votar por usted entre el 6 y el 30 de junio de 2023. 
	</div>
		<form class="form" onsubmit="generateImage(); return false;">
			<br/>
			<input type="file" accept="image/*" id="profile-image" class="hidden" required>
			<label class='boton' for="profile-image">1. Haga clic para seleccionar una foto de perfil:</label>
			
			<br/>
			
			<div>Le recomendamos una imagen cuadrada con su rostro en el centro, por ejemplo, la foto de perfil que usa en Whatsapp. Puede usar también herramientas como <a href='https://pfpmaker.com/' target='_blank'>https://pfpmaker.com/</a> para crear una foto de perfil en línea.</div>

			<br/>
			
			<label class='boton' for="title">2. Ingrese el nombre del candidato/a:</label>
			
			<br/>
			
			<input type="text" id="title" class='textarea' placeholder="Ingrese su nombre...">
			
			<br/>

			<label class='boton' for="description">3. Ingrese su perfil/experiencia (máximo 200 caracteres):</label>
			
			<br/>
			
			<textarea id="description" placeholder="Describe brevemente tu perfil..." maxlength="200"></textarea>

			<label class='boton' for="sector">4. Ingrese el sector al que aspira representar:</label>
			
			<br/>
			
			<input type="text" id="sector" class='textarea' placeholder="Ingrese el sector...">
			
			<br/>
			
			<p class='boton'>5. Seleccione el tratamiento:</p>
			
			<table>
			<tbody>
			<tr>
				  <td><input class='inline' type="radio" id="candidato" name="tratamiento" value="Candidato " checked></td>
				  <td><label class='inline' for="candidato">Candidato</label></td>
				  <td><input class='inline' type="radio" id="candidata" name="tratamiento" value="Candidata "></td>
				  <td><label class='inline' for="candidata">Candidata</label></td>
				  <td><input class='inline' type="radio" id="candidate" name="tratamiento" value="Candidate "></td>
				  <td><label class='inline' for="candidate">Candidate</label></td>
				  <td><input class='inline' type="radio" id="ninguno" name="tratamiento" value=""></td>
				  <td><label class='inline' for="ninguno">Ninguno</label></td>
			</tr>
			</tbody>
			</table>
			
			<br/>
			
			<p class='boton'>6. Elija una paleta de colores:</p>
			
			<table>
			<tbody>
			<tr>
				  <td><input class='inline' type="radio" id="paleta1" name="paleta" value="1" checked></td>
				  <td><label class='inline' for="paleta1">Rojo-Dorado</label></td>
				  <td><input class='inline' type="radio" id="paleta2" name="paleta" value="2"></td>
				  <td><label class='inline' for="paleta2">Violeta-Dorado</label></td>
				  <td><input class='inline' type="radio" id="paleta3" name="paleta" value="3"></td>
				  <td><label class='inline' for="paleta3">Turquesa-Violeta</label></td>
				  <td><input class='inline' type="radio" id="paleta4" name="paleta" value="4"></td>
				  <td><label class='inline' for="paleta4">Azul-Dorado</label></td>
			</tr>
			</tbody>
			</table>
			
			<br/>

			<button class="btn" type="submit">Crear publicidad</button>
		</form>

		<div id="image-container"></div>
		
		<br/>
		
	</div>

	<script type="text/javascript">
		function generateImage() {
			const profileImage = document.getElementById('profile-image').files[0];
			const title = document.getElementById('title').value;
			const description = document.getElementById('description').value;
			const sector = document.getElementById('sector').value;
			const tratamiento = document.querySelector('input[name="tratamiento"]:checked').value;
			const postulacion = tratamiento + "Sector " + sector;
			const paleta = document.querySelector('input[name="paleta"]:checked').value;

			// Create a canvas element
			const canvas = document.createElement('canvas');
			canvas.width = 720;
			canvas.height = 720;
			
			// Function to circle image
			// Que la imagen cuadrada quede envuelta en un círculo
			function roundedImage(x,y,width,height,radius){
				  ctx.beginPath();
				  ctx.moveTo(x + radius, y);
				  ctx.lineTo(x + width - radius, y);
				  ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
				  ctx.lineTo(x + width, y + height - radius);
				  ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
				  ctx.lineTo(x + radius, y + height);
				  ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
				  ctx.lineTo(x, y + radius);
				  ctx.quadraticCurveTo(x, y, x + radius, y);
				  ctx.closePath();
			}

			// Insertamos una fuente personalizada para el canvas
			let myFont = new FontFace(
			  "Source Sans Pro",
			  "url(https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lqDY.woff2)"
			);

			myFont.load().then((font) => {
			  document.fonts.add(font);
			  console.log("Font loaded");
			});
			
			// Habilita salto de línea en textos largos llamando 
			// context.fillText recurrentemente
			function printAtWordWrap( context , text, x, y, lineHeight, fitWidth)
				{
					fitWidth = fitWidth || 0;
					
					if (fitWidth <= 0)
					{
						context.fillText( text, x, y );
						return;
					}
					var words = text.split(' ');
					var currentLine = 0;
					var idx = 1;
					while (words.length > 0 && idx <= words.length)
					{
						var str = words.slice(0,idx).join(' ');
						var w = context.measureText(str).width;
						if ( w > fitWidth )
						{
							if (idx==1)
							{
								idx=2;
							}
							context.fillText( words.slice(0,idx-1).join(' '), x, y + (lineHeight*currentLine) );
							currentLine++;
							words = words.splice(idx-1);
							idx = 1;
						}
						else
						{idx++;}
					}
					if  (idx > 0)
						context.fillText( words.join(' '), x, y + (lineHeight*currentLine) );
				}

			// Draw the dummy background image on the canvas
			const ctx = canvas.getContext('2d');
			const bg = new Image();
			bg.crossOrigin="anonymous";
			if (paleta == "1") {
				bg.src = "https://felipe-calvo.github.io/static/scrd/plantilla-rojo-amarillo.png";
			} else if (paleta == "2") {
				bg.src = "https://felipe-calvo.github.io/static/scrd/plantilla-fucsia-amarillo.png";
			} else if (paleta == "3") {
				bg.src = "https://felipe-calvo.github.io/static/scrd/plantilla-verde-fucsia.png";
			} else {
				bg.src = "https://felipe-calvo.github.io/static/scrd/plantilla-azul-dorado.png";
			}
			bg.onload = () => {
				ctx.drawImage(bg, 0, 0, 720, 720);
				
				// Draw the profile image on the canvas
				const img = new Image();
				img.src = URL.createObjectURL(profileImage);
				img.onload = () => {
					ctx.save();
					roundedImage(420,230,280,280,140);
					ctx.clip();
					ctx.drawImage(img, 420, 230, 280, 280);
					ctx.restore();
					
					// Add the title, sector and description to the image
					ctx.fillStyle = "#e3af3e";
					ctx.font = "bold 38px Source Sans Pro";
					ctx.fillText(title, 34, 280, 360);
					ctx.fillStyle = "#FFFFFF";
					ctx.font = "bold 30px Source Sans Pro";
					ctx.fillText(postulacion, 34, 330, 360);
					ctx.fillStyle = "#e3af3e";
					ctx.font = "24px Source Sans Pro";
					printAtWordWrap(ctx, description, 36, 370, 28, 360);

					// Convert the canvas to a data URL and display the image
					const imageContainer = document.getElementById('image-container');
					const dataURL = canvas.toDataURL('image/png');
					imageContainer.innerHTML = `<img crossorigin="anonymous" src="${dataURL}" alt="Generated Image">`;
				}
			};
		}
	</script>
</body>
</html>